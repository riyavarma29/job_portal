{% extends 'app/base.html' %}
{% block content %}
<h2>Available Jobs</h2>

<form method="get">
    <div class="filters">
  <input type="text" name="title" placeholder="Search by job title" value="{{ request.GET.title }}" />
  
  <select name="category">
    <option value="">All Categories</option>
    <option value="Website" {% if request.GET.category == "Website" %}selected{% endif %}>Website</option>
    <option value="App" {% if request.GET.category == "App" %}selected{% endif %}>App</option>
    <option value="Tutoring" {% if request.GET.category == "Tutoring" %}selected{% endif %}>Tutoring</option>
  </select>

  <input type="number" name="min_salary" placeholder="Min Budget" value="{{ request.GET.min_salary }}">
  <input type="number" name="max_salary" placeholder="Max Budget" value="{{ request.GET.max_salary }}">

  <button type="submit">Filter</button>
  </div>
</form>
<ul>
  {% for job in jobs %}
    <li>
      <strong>{{ job.title }}</strong><br>
      {{ job.category }} | â‚¹{{ job.budget }}<br>
      {{ job.description }}
      <p><strong>Posted by:</strong> {{ job.posted_by.username }}</p>

      {% if user.is_authenticated and job.posted_by == user %}
        <div class="owner-actions" style="margin-top: 5px;">
          <a href="{% url 'edit_job' job.id %}" class="edit-btn">Edit</a>
          <a href="{% url 'delete_job' job.id %}" class="delete-btn" style="margin-left:10px;">Delete</a>

          {% if user.is_authenticated and user.profile.role == 'shop_owner' and job.posted_by == user %}
          <a href="{% url 'view_applicants' job.id %}" class="btn btn-outline">View Applicants</a>
          {% endif %}

        </div>

      {% elif user.is_authenticated and user.profile.role == 'developer' %}
        <div class="developer-actions" style="margin-top: 10px;">
          <!-- Apply button -->
          <form id="apply-form-{{ job.id }}" method="post" action="{% url 'apply_to_job' job.id %}" style="display: none;">
            {% csrf_token %}
          </form>
          <a href="#" class="btn btn-primary" onclick="document.getElementById('apply-form-{{ job.id }}').submit(); return false;">Apply</a>

          <!-- Save button (mock link) -->
          <a href="{% url 'save_job' job.id %}" class="btn btn-outline-success btn-sm" style="margin-left: 10px;">Save</a>
          
          <a href="javascript:void(0);" class="btn btn-outline-success btn-sm" onclick="openShareModal({{ job.id }}, '{{ job.title }}', '{{ job.description }}')">Share</a>

        <!-- Share Options -->
      
        <div id="shareModal" class="modal-overlay" style="display:none;">
          <div class="modal-content">
            <h3>Share This Job</h3>
            <div class="share-buttons">
            <a id="emailShare" class="share-btn" target="_blank">ğŸ“§ Email</a>
            <a id="whatsappShare" class="share-btn" target="_blank">ğŸ’¬ WhatsApp</a>
            <button id="copyLinkBtn" class="share-btn" onclick="copyJobLink()">ğŸ”— Copy Link</button>
            <a id="twitterShare" class="share-btn" target="_blank">ğŸ¦ Twitter</a>
            <a id="linkedinShare" class="share-btn" target="_blank">ğŸ”— LinkedIn</a>
          </div>

            <button class="close-modal" onclick="closeShareModal()">Close</button>
          </div>
        </div>

        </div>
      {% endif %}
    </li>
  {% empty %}
    <li>No jobs found matching your criteria.</li>
  {% endfor %}
</ul>

{% endblock %}
